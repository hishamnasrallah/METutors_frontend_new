<div class="subject-list" *ngLet="(subjects$ | async) as subjects">
  <div class="row">
    <div class="col-md-12">
      <div class="mt-2">
        <ng-container [ngSwitch]="isLoading$ | async">
          <div class="mt-4" *ngSwitchCase="true">
            <metutors-grid-placeholder></metutors-grid-placeholder>
          </div>

          <ng-container *ngSwitchCase="false">
            <div class="row mb-3">
              <div class="col-12">
                <h2 class="title"> Subject List
                  <button mat-flat-button color="primary" class="float-end"
                    (click)="onOpenAddNewSubject(); selectedSubject = undefined">
                    Add Subject
                  </button>
                </h2>
              </div>
            </div>
            <div class="row filters">
              <div class="col-md-9">
                <span class="title">Filters</span>
                <mat-form-field appearance="outline" class="me-2">
                  <mat-select [placeholder]="'By Program'" [(ngModel)]="program"
                    (selectionChange)="onChangeSelection()">
                    <mat-option [value]="program?.id" *ngFor="let program of programs$ | async">
                      {{ program?.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline" class="me-2">
                  <mat-select [placeholder]="'By Country'" [(ngModel)]="country"
                    (selectionChange)="onChangeSelection()">
                    <mat-option [value]="country?.id" *ngFor="let country of countries$ | async">
                      {{ country?.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline" class="me-2">
                  <mat-select [placeholder]="'By Grade'" [(ngModel)]="grade" (selectionChange)="onChangeSelection()">
                    <mat-option [value]="i" *ngFor="let grade of grades; let i = index">
                      {{ grade }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline" class="me-2">
                  <mat-select [placeholder]="'Field of Study'" [(ngModel)]="fieldOfStudy"
                    (selectionChange)="onChangeSelection()">
                    <mat-option [value]="field?.id" *ngFor="let field of fields$ | async">
                      {{ field?.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline" class="me-2">
                  <mat-select [placeholder]="'By Status'" [(ngModel)]="status" (selectionChange)="onChangeSelection()">
                    <mat-option [value]="state.id" *ngFor="let state of statuses">
                      {{ state.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div class="col-md-3">
                <div class="position-relative search-request">
                  <mat-icon>search</mat-icon>
                  <input type="text" class="form-control custom-input input-bordered" [(ngModel)]="title"
                    placeholder="Search..." (keyup)="onChangeSelection()">
                </div>
              </div>
            </div>

            <table class="table my-table default-title mt-4 overflow-visible">
              <tr>
                <th>Number</th>
                <th>Program</th>
                <th>Country</th>
                <th>Grade</th>
                <th>Field of Study</th>
                <th>Subject</th>
                <th>Price(USD/hr)</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
              <tr *ngIf="!subjects || !subjects.length">
                <td colspan="9">
                  <div class="text-center">No records found</div>
                </td>
              </tr>
              <tr *ngFor="let subject of subjects; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ subject?.program?.name }}</td>
                <td>{{ subject?.country?.name }}</td>
                <td>{{ grades[subject?.grade] }}</td>
                <td>{{ subject?.field?.name }}</td>
                <td>{{ subject?.name }}</td>
                <td>{{ subject?.pricePerHour }}</td>
                <td>
                  <div dropdown class="change-status position-relative d-flex">
                    <button dropdownToggle class="status text-capitalize" mat-button [ngClass]="{
                        'active': subjectStatus.active === subject?.status,
                        'inactive': subjectStatus.inActive === subject?.status
                      }">
                      <ng-container *ngIf="subjectStatus.active === subject?.status">Active</ng-container>
                      <ng-container *ngIf="subjectStatus.inActive === subject?.status">Inactive</ng-container>
                    </button>
                    <ul *dropdownMenu class="dropdown-menu dropdown-menu-right statues p-0" role="menu">
                      <li role="menuitem" class="cursor-pointer text-capitalize" *ngFor="let status of statuses"
                        [ngClass]="{
                        'active': subjectStatus.active === status.id,
                        'inactive': subjectStatus.inActive === status.id
                        }" (click)="onChangeStatus(subject, status.id)">
                        {{ status.name }}
                      </li>
                    </ul>
                  </div>
                </td>
                <td>
                  <button mat-icon-button class="p-0 action me-2" disabled
                    *ngIf="(isDeletingSubject$ | async) && deletedSubject?.id === subject.id">
                    <mat-icon class="spinner">autorenew</mat-icon>
                  </button>
                  <button mat-icon-button class="p-0 action me-2" (click)="deleteSubject(subject)"
                    *ngIf="deletedSubject?.id !== subject.id">
                    <mat-icon>delete</mat-icon>
                  </button>
                  <button mat-icon-button class="p-0 action" (click)="onOpenAddNewSubject(); selectedSubject = subject">
                    <img src="../../../../../../assets/svg/edit-green.svg" width="17" height="17" alt="">
                  </button>
                </td>
              </tr>
            </table>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>
</div>

<metutors-admin-add-new-subject-modal *ngIf="showAddNewSubjectModal$ | async"
                                      (closeModal)="onCloseAddNewSubject()"
                                      [programs]="(programs$ | async)!"
                                      [countries]="(countries$ | async)!"
                                      [fields]="(fields$ | async)!"
                                      [selectedSubject]="selectedSubject!"
                                      [isAdding]="(isAddingEditingSubject$ | async)!"
                                      [showModal]="(showAddNewSubjectModal$ | async)!"
                                      (submitForm)="onAddEditSubject($event)">
</metutors-admin-add-new-subject-modal>
