<ng-container *ngLet="(view$ | async) as view">
  <ng-container [ngSwitch]="view.loading">
    <div class="p-4" *ngSwitchCase="true">
      <metutors-grid-placeholder></metutors-grid-placeholder>
    </div>

    <form #f="ngForm" class="account-settings" [formGroup]="form" (ngSubmit)="onSubmit(form)" *ngSwitchCase="false">
      <div class="avatar-block">
        <div class="row mb-3">
          <div class="col-md-12 d-flex">
            <div class="row avatar-name align-items-center">
              <div class="col-md-3">
                <div class="position-relative px-3">
                  <div class="img-status position-relative">
                    <img [src]="view.student?.avatar" meTutorsDefaultAvatar alt="" class="rounded-circle" draggable="false"
                         [class.uploading]="isChangeAvatar$ | async">
                    <mat-icon class="spinner" *ngIf="isChangeAvatar$ | async">autorenew</mat-icon>
                  </div>
                </div>
              </div>
            </div>

            <div>
              <h2>Upload profile photo</h2>
              <h5>JPG, GIF or PNG. Max size of 1MB</h5>
              <div style="height:0;overflow:hidden">
                <input type="file" id="fileInput" name="fileInput" #filePicker (change)="uploadProfilePic($event)"/>
              </div>
              <button mat-button type="button" (click)="filePicker.click()">
                <mat-icon>cloud_upload</mat-icon>
                Upload file
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="row mb-3 form-group">
        <div class="col-md-6">
          <h3>First Name</h3>
          <input type="text" class="form-control custom-input input-bordered" placeholder="Kamran"
                 formControlName="first_name">
          <div class="text-danger" *ngIf="firstName?.['touched'] && firstName?.errors?.['required']">
            Please write your First Name
          </div>
          <div class="text-danger" *ngIf="firstName?.['touched'] && firstName?.errors?.['pattern']">
            First Name should only contains alphabets
          </div>
          <div class="text-danger"
               *ngIf="firstName?.['touched'] && firstName?.errors?.['minlength'] && !firstName?.errors?.['required'] && !firstName?.errors?.['pattern']">
            First Name cannot be less than 3 characters
          </div>
          <div class="text-danger"
               *ngIf="firstName?.['touched'] && firstName?.errors?.['maxlength'] && !firstName?.errors?.['pattern']">
            First Name cannot be greater than 100 characters
          </div>
        </div>
      </div>
      <div class="row mb-3 form-group">
        <div class="col-md-6">
          <h3>Last Name</h3>
          <input type="text" class="form-control custom-input input-bordered" placeholder="Khatti"
                 formControlName="last_name">
          <div class="text-danger" *ngIf="lastName?.['touched'] && lastName?.errors?.['required']">
            Please write your Last Name
          </div>
          <div class="text-danger" *ngIf="lastName?.['touched'] && lastName?.errors?.['pattern']">
            Last Name should only contains alphabets
          </div>
          <div class="text-danger"
               *ngIf="lastName?.['touched'] && lastName?.errors?.['minlength'] && !lastName?.errors?.['required'] && !lastName?.errors?.['pattern']">
            Last Name cannot be less than 3 characters
          </div>
          <div class="text-danger"
               *ngIf="lastName?.['touched'] && lastName?.errors?.['maxlength'] && !lastName?.errors?.['pattern']">
            Last Name cannot be greater than 100 characters
          </div>
        </div>
      </div>
      <div class="row mb-3 form-group">
        <div class="col-md-6">
          <h3>Email Address</h3>
          <input type="email" class="form-control custom-input input-bordered" placeholder="hello@gmail.com"
                 formControlName="email" readonly>
        </div>
      </div>

      <div class="row mb-3 form-group">
        <div class="col-md-6">
          <h3>Headline</h3>
          <input type="text" class="form-control custom-input input-bordered"
                 placeholder="Add a professional headline like, 'Student at harvard' " formControlName="headline">
        </div>
      </div>

      <div class="row mb-3 form-group">
        <div class="col-md-6">
          <h3>Country of Residence</h3>
          <mat-form-field appearance="outline" class="w-100">
            <mat-select formControlName="country" [placeholder]="'Choose Country'">
              <mat-option>
                <ngx-mat-select-search [(ngModel)]="filterCountry" [ngModelOptions]="{standalone: true}"
                                       placeholderLabel="Search..." noEntriesFoundLabel="No matching country found">
                </ngx-mat-select-search>
              </mat-option>
              <mat-option *ngFor="let country of filteredCountries" [value]="country.id">{{ country.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div class="row mb-3 form-group">
        <div class="col-md-6">
          <h3>Gender</h3>
          <mat-form-field appearance="outline" class="w-100">
            <mat-select formControlName="gender" [placeholder]="'Male'">
              <mat-option [value]="gender" *ngFor="let gender of genders">{{ gender }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div class="row btn-list">
        <div class="col-12 d-flex justify-content-end">
          <button mat-flat-button color="primary" type="submit"
                  [disabled]="form.invalid || (isSavingProfile | async)">Update
            <mat-icon class="spinner" *ngIf="(isSavingProfile | async)">autorenew</mat-icon>
          </button>
        </div>
      </div>
    </form>
  </ng-container>
</ng-container>
