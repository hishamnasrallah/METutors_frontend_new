<ng-container *ngIf="isLoadingTutor">
  <metutors-grid-placeholder></metutors-grid-placeholder>
  <metutors-grid-placeholder></metutors-grid-placeholder>
</ng-container>

<ng-container *ngIf="!isLoadingTutor">
  <div class="profile-header mb-3 position-relative">
    <button mat-button class="status-interview" *ngIf="tutor?.interviewRequest" [ngClass]="{
        'pending': tutor?.interviewRequest?.status === interviewStatus.pending,
        'approved': tutor?.interviewRequest?.status === interviewStatus.approved,
        'rejected': tutor?.interviewRequest?.status === interviewStatus.rejected,
        'scheduled': tutor?.interviewRequest?.status === interviewStatus.scheduled
      }"
      [matTooltip]="tutor.interviewRequest && tutor.interviewRequest.adminComments ? tutor.interviewRequest.adminComments : ''"
      [matTooltipPosition]="'above'" matTooltipHideDelay="100000"
      [matTooltipDisabled]="!tutor?.interviewRequest?.adminComments">
      <ng-container *ngIf="tutor?.interviewRequest?.status === interviewStatus.pending">
        Account Under Review
      </ng-container>
      <ng-container *ngIf="tutor?.interviewRequest?.status === interviewStatus.approved">
        Account Approved
      </ng-container>
      <ng-container *ngIf="tutor?.interviewRequest?.status === interviewStatus.rejected">
        Account Rejected
      </ng-container>
      <ng-container *ngIf="tutor?.interviewRequest?.status === interviewStatus.scheduled">
        Interview Scheduled
      </ng-container>
    </button>
    <div class="row">
      <div class="col-12">
        <div class="cover position-relative" [ngStyle]="{'background-image': 'url(' + tutor?.cover + ')'}">
          <input type="file" #filePicker (change)="onChangeCover($event)" hidden accept="image/*" />
          <button type="button" mat-flat-button color="primary" class="upload-cover" [disabled]="isChangeCover && !isAvatar"
            (click)="filePicker.click()">
            <img src="assets/svg/upload-solid-white.svg" draggable="false" width="15" height="15"
              *ngIf="!isChangeCover" />
            <mat-icon class="spinner" *ngIf="isChangeCover && !isAvatar">autorenew</mat-icon>
            Upload
          </button>
        </div>
        <div class="row avatar-name align-items-center">
          <div class="col-md-3">
            <div class="position-relative px-3">
              <div class="img-status position-relative">
                <img [src]="tutor?.avatar" meTutorsDefaultAvatar alt="" class="rounded-circle" draggable="false"
                  [class.uploading]="isChangeAvatar && isAvatar">
                <mat-icon class="spinner" *ngIf="isChangeAvatar && isAvatar">autorenew</mat-icon>
              </div>
            </div>
          </div>
        </div>
        <div class="row mt-1 mb-2">
          <div class="col-md-3">
            <input type="file" #filePicker1 (change)="onChangeAvatar($event)" hidden accept="image/*" />
            <button type="button" mat-button class="upload-btn mx-2" (click)="filePicker1.click()"
              [disabled]="isChangeAvatar && isAvatar">
              <img src="assets/svg/upload-solid.svg" width="15" height="15" draggable="false" alt="">
              Upload Profile Picture
            </button>
          </div>
          <div class="col-md-9 d-flex justify-content-end align-items-center">
            <button mat-flat-button color="primary" class="mx-2" (click)="submitInterview.emit()"
              *ngIf="!tutor?.interviewRequest">
              Submit Interview Request
            </button>
            <ng-container *ngIf="tutor?.interviewRequest?.status === interviewStatus.scheduled">
              <div class="interview-details">
                <span>{{ tutor?.interviewRequest?.interviewDate | date: 'YYYY-MM-d' }}</span>
                <span class="ms-2">{{ tutor?.interviewRequest?.interviewTime | date: 'h:mm a' }}</span>
              </div>
              <button mat-flat-button color="primary" class="mx-2"
                (click)="joinMeeting.emit(tutor?.interviewRequest?.id)">
                Join Meeting
              </button>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card complete-form mb-3">
    <form class="card-body" [formGroup]="personalInfoForm" (ngSubmit)="submitPersonalInfo(personalInfoForm)">
      <div class="d-flex justify-content-between align-items-center w-100 mb-4">
        <h1 class="title">Personal Information</h1>

        <div>
          <metutors-submit-button [form]="personalInfoForm" [isSubmitting]="isUpdateProfile && selectedForm === 1"
            [isDisabled]="tutor?.interviewRequest?.status === interviewStatus.pending || tutor?.interviewRequest?.status === interviewStatus.scheduled || tutor?.interviewRequest?.status === interviewStatus.rejected">
            Update
          </metutors-submit-button>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="firstName" class="form-label">First Name</label>
            <input type="text" class="custom-input w-100 input-bordered" id="firstName" placeholder="Enter First Name"
              formControlName="firstName">
            <div class="text-danger" *ngIf="firstName?.touched && firstName?.invalid">
              Please write a valid name
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="lastName" class="form-label">Last Name</label>
            <input type="text" class="custom-input w-100 input-bordered" id="lastName" placeholder="Enter Last Name"
              formControlName="lastName">
            <div class="text-danger" *ngIf="lastName?.touched && lastName?.invalid">
              Please write a valid name
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="middleName" class="form-label">Middle Name <span>(Optional)</span></label>
            <input type="text" class="custom-input w-100 input-bordered" id="middleName" placeholder="Enter Middle Name"
              formControlName="middleName">
            <div class="text-danger" *ngIf="middleName?.touched && middleName?.invalid">
              Please write a valid name
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="nationality" class="form-label">Nationality</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-select formControlName="nationality" [placeholder]="'Select your nationality'">
                <mat-option>
                  <ngx-mat-select-search [(ngModel)]="filterNationality" [ngModelOptions]="{standalone: true}"
                    placeholderLabel="Search..." noEntriesFoundLabel="No matching country found">
                  </ngx-mat-select-search>
                </mat-option>
                <mat-option *ngFor="let country of filteredNationalities" [value]="country.name">{{ country.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <div class="text-danger" *ngIf="nationality?.touched && nationality?.invalid">
              Please choose your Nationality
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="dateOfBirth" class="form-label">Date of Birth</label>
            <mat-form-field appearance="outline" class="w-100">
              <input matInput [matDatepicker]="dateOfBirthPicker" [placeholder]="'Select Your Date of Birth'"
                (focus)="dateOfBirthPicker.open()" formControlName="dateOfBirth" [max]="maxDate">
              <mat-datepicker-toggle matSuffix [for]="dateOfBirthPicker"></mat-datepicker-toggle>
              <mat-datepicker #dateOfBirthPicker></mat-datepicker>
            </mat-form-field>
            <div class="text-danger" *ngIf="dateOfBirth?.touched && dateOfBirth?.invalid">
              Please select your Date of Birth
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="address" class="form-label">Address 1</label>
            <input type="text" class="custom-input w-100 input-bordered" id="address" placeholder="Enter Street Address"
              formControlName="address">
            <div class="text-danger" *ngIf="address?.touched && address?.invalid">
              Please write your Address with a max of 120 characters
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="gender" class="form-label">Select Gender</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-select formControlName="gender" [placeholder]="'Male'">
                <mat-option [value]="gender" *ngFor="let gender of genders">{{ gender }}</mat-option>
              </mat-select>
            </mat-form-field>
            <div class="text-danger" *ngIf="gender?.touched && gender?.invalid">
              Please choose your Gender
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="address2" class="form-label">Address 2 (Optional)</label>
            <input type="text" class="custom-input w-100 input-bordered" id="address2"
              placeholder="Enter street address" formControlName="address2">
            <div class="text-danger" *ngIf="address2?.touched && address2?.invalid">
              Please write your Address with a max of 120 characters
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="bio" class="form-label w-100">Add Bio <small class="text-danger fw-normal">
                (200 to 400 characters)
              </small>
              <metutors-char-counter [limit]="400" [controlName]="bio"></metutors-char-counter>
            </label>
            <textarea id="bio" class="custom-input w-100 input-bordered" [placeholder]="'Add Bio here... '" rows="10"
              formControlName="bio"></textarea>
            <div class="text-danger" *ngIf="bio?.touched && bio?.invalid">
              Please write valid Bio
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="postalCode" class="form-label">Postal Code</label>
            <input type="text" class="custom-input w-100 input-bordered" id="postalCode" placeholder="Postal Code"
              formControlName="postalCode">
            <div class="text-danger" *ngIf="postalCode?.touched && postalCode?.invalid">
              Please write a valid Postal Code
            </div>
          </div>

          <div class="form-group">
            <label for="country" class="form-label">Country</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-select formControlName="country" [placeholder]="'Select Country'"
                (selectionChange)="loadCities.emit(country?.value)">
                <mat-option>
                  <ngx-mat-select-search [(ngModel)]="filterCountry" [ngModelOptions]="{standalone: true}"
                    placeholderLabel="Search..." noEntriesFoundLabel="No matching country found">
                  </ngx-mat-select-search>
                </mat-option>
                <mat-option *ngFor="let country of filteredCountries" [value]="country.id">{{ country.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <div class="text-danger" *ngIf="country?.touched && country?.invalid">
              Please choose your Country
            </div>
          </div>

          <div class="form-group">
            <label for="city" class="form-label">City</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-select formControlName="city" [placeholder]="'Select city'" [disabled]="!cities || !cities.length">
                <mat-option>
                  <ngx-mat-select-search [(ngModel)]="filterCity" [ngModelOptions]="{standalone: true}"
                    placeholderLabel="Search..." noEntriesFoundLabel="No matching city found">
                  </ngx-mat-select-search>
                </mat-option>
                <mat-option *ngFor="let city of filteredCities" [value]="city.name">{{ city.name }}</mat-option>
              </mat-select>
            </mat-form-field>
            <div class="text-danger" *ngIf="city?.touched && city?.invalid">
              Please choose your City
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div class="card complete-form mb-3">
    <form class="card-body" [formGroup]="qualificationForm" (ngSubmit)="submitQualificationDetails(qualificationForm)">
      <div class="d-flex justify-content-between align-items-center w-100 mb-4">
        <h1 class="title">Qualification Details</h1>

        <div>
          <metutors-submit-button [form]="qualificationForm" [isSubmitting]="isUpdateProfile && selectedForm === 2"
            [isDisabled]="tutor?.interviewRequest?.status === interviewStatus.pending || tutor?.interviewRequest?.status === interviewStatus.scheduled || tutor?.interviewRequest?.status === interviewStatus.rejected">
            Update
          </metutors-submit-button>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="nameOfUniversity" class="form-label">University Name</label>
            <input type="text" class="custom-input w-100 input-bordered" id="nameOfUniversity" placeholder="Enter Name"
              formControlName="nameOfUniversity">
            <div class="text-danger" *ngIf="nameOfUniversity?.touched && nameOfUniversity?.invalid">
              Please Write Your University Name
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="teachingExperience" class="form-label">Teaching Experience (In Schools)</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-select formControlName="teachingExperience" [placeholder]="'Select Years'">
                <mat-option [value]="experience" *ngFor="let experience of experiences">{{ experience }}</mat-option>
              </mat-select>
            </mat-form-field>
            <div class="text-danger" *ngIf="teachingExperience?.touched && teachingExperience?.invalid">
              Please Choose Your Years of Teacher Experience
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="degreeLevel" class="form-label">Degree Level</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-select formControlName="degreeLevel" [placeholder]="'Select Degree Level'"
                (selectionChange)="resetDegreeField()">
                <mat-option [value]="level" *ngFor="let level of degreeLevels">{{ level }}</mat-option>
              </mat-select>
            </mat-form-field>
            <div class="text-danger" *ngIf="degreeLevel?.touched && degreeLevel?.invalid">
              Please Choose Your Degree Level
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="teachingExperienceOnline" class="form-label">Teaching Experience (Online)</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-select formControlName="teachingExperienceOnline" [placeholder]="'Select Years'">
                <mat-option [value]="experience" *ngFor="let experience of experiences">{{ experience }}</mat-option>
              </mat-select>
            </mat-form-field>
            <div class="text-danger" *ngIf="teachingExperienceOnline?.touched && teachingExperienceOnline?.invalid">
              Please Choose Your Years of Teacher Experience Online
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="degreeField" class="form-label">Degree Field/Major</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-select formControlName="degreeField" [placeholder]="'Computer Science'">
                <mat-option>
                  <ngx-mat-select-search [(ngModel)]="filterDegree" [ngModelOptions]="{standalone: true}"
                    placeholderLabel="Search..." noEntriesFoundLabel="No matching degree field found">
                  </ngx-mat-select-search>
                </mat-option>
                <mat-option [value]="field" *ngFor="let field of filteredDegreeFields">{{ field }}</mat-option>
              </mat-select>
            </mat-form-field>
            <div class="text-danger" *ngIf="degreeField?.touched && degreeField?.invalid">
              Please Choose Your Degree Field
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="currentEmployer" class="form-label">Current Employer (Optional)</label>
            <input type="text" class="custom-input w-100 input-bordered" id="currentEmployer" placeholder="Enter Here"
              formControlName="currentEmployer">
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="computerSkills" class="form-label">Computer Skills Level</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-select formControlName="computerSkills" [placeholder]="'Above Average'">
                <mat-option [value]="skill" *ngFor="let skill of skills">{{ skill }}</mat-option>
              </mat-select>
            </mat-form-field>
            <div class="text-danger" *ngIf="computerSkills?.touched && computerSkills?.invalid">
              Please Choose Your Computer Skills Level
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="currentTitle" class="form-label">Current Title (Optional)</label>
            <input type="text" class="custom-input w-100 input-bordered" id="currentTitle" placeholder="Enter Here"
              formControlName="currentTitle">
          </div>
        </div>
      </div>
    </form>
  </div>

  <div class="card complete-form mb-3">
    <form class="card-body" [formGroup]="teachingForm" (ngSubmit)="submitTeachingSpecification(teachingForm)">
      <div class="d-flex justify-content-between align-items-center w-100 mb-4">
        <h1 class="title">Teaching Specifications</h1>

        <div>
          <metutors-submit-button [form]="teachingForm" [isSubmitting]="isUpdateProfile && selectedForm === 3"
            [isDisabled]="tutor?.interviewRequest?.status === interviewStatus.pending || tutor?.interviewRequest?.status === interviewStatus.scheduled || tutor?.interviewRequest?.status === interviewStatus.rejected">
            Update
          </metutors-submit-button>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="startDate" class="form-label">When you are Available to Start?</label>
            <mat-form-field appearance="outline" class="w-100">
              <input matInput [matDatepicker]="startDatePicker" [placeholder]="'Select Start Date'"
                (focus)="startDatePicker.open()" [min]="minDate" formControlName="startDate">
              <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #startDatePicker></mat-datepicker>
            </mat-form-field>
            <div class="text-danger" *ngIf="startDate?.touched && startDate?.invalid">
              Please select your Availability to Start
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label class="form-label">Tutoring Preferences</label>
            <mat-radio-group class="d-flex flex-row mt-3" formControlName="typeOfTutoring">
              <mat-radio-button [class.ms-3]="!isFirst" [value]="type.value"
                *ngFor="let type of types | keyvalue: returnZero; let isFirst = first" [disabled]="type.key !== 'one'">
                {{ type?.value }}
              </mat-radio-button>
            </mat-radio-group>
            <div class="text-danger" *ngIf="typeOfTutoring?.touched && typeOfTutoring?.invalid">
              Please select Type of Tutoring
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="endDate" class="form-label">Availability End Date</label>
            <mat-form-field appearance="outline" class="w-100">
              <input matInput [matDatepicker]="endDatePicker" [placeholder]="'Select Availability End Date'"
                (focus)="endDatePicker.open()" [min]="startDate?.value" formControlName="endDate">
              <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #endDatePicker></mat-datepicker>
            </mat-form-field>
            <div class="text-danger" *ngIf="endDate?.touched && endDate?.invalid">
              Please select your Availability End Date
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label class="form-label">How many days per week are you available? </label>
            <div class="list-days">
              <button type="button" mat-button [class.active]="selectedDays?.includes(i)"
                *ngFor="let day of days; let i = index" (click)="onChangeDay(i)">{{ day }}</button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div class="card complete-form">
    <div class="card-body">
      <h1 class="title">Teaching Courses & Rates <span>(To edit this information, please contact admin)</span></h1>

      <div class="row mt-4" *ngIf="tutor?.sortedSubjects && tutor?.sortedSubjects?.length">
        <div class="col-md-12" *ngFor="let item of tutor?.sortedSubjects; let indexSubjects = index; let isLast = last"
          [class.mb-4]="!isLast">
          <table class="table my-table default-title mb-0">
            <tr>
              <th class="heading" [attr.colspan]="item?.programId === nationalId ? '2' : '1'">
                <label>Program: </label> <span>
                  {{ item?.programName }}<ng-container *ngIf="item?.programId === nationalId">
                    {{ item?.countryName }}
                  </ng-container>
                </span>
              </th>
              <th class="heading text-end"><label>Study Field: </label> <span>{{ item?.fieldName }}</span></th>
            </tr>
            <tr>
              <th class="sub-heading"
                [ngClass]="{'w-80': item?.programId !== nationalId, 'w-60': item?.programId === nationalId}">Subject
                Name</th>
              <th class="sub-heading w-20" *ngIf="item?.programId === nationalId">Grade</th>
              <th class="sub-heading">Hourly Rate (USD)</th>
            </tr>
            <tr *ngFor="let subject of item.subjects">
              <td>{{ subject?.subject }}</td>
              <td *ngIf="item?.programId === nationalId">{{ subject?.gradeName }}</td>
              <td>
                {{ subject?.pricePerHour }}
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</ng-container>
